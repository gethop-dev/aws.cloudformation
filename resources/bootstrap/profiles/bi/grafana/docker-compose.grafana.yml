services:
  grafana:
    image: grafana/grafana:{{project.profiles.bi-grafana.version}}
    deploy:
      resources:
        limits:
          memory: ${MEMORY_LIMIT_GRAFANA}
    environment:
      - GF_SERVER_DOMAIN
      - GF_SERVER_HTTP_PORT
      - GF_SERVER_ROOT_URL
      - GF_AUTH_ANONYMOUS_ENABLED
      - GF_SECURITY_ADMIN_USER
      - GF_SECURITY_ADMIN_PASSWORD
      - GF_SECURITY_ALLOW_EMBEDDING
      - GF_AUTH_GENERIC_OAUTH_ENABLED
      - GF_AUTH_GENERIC_OAUTH_CLIENT_ID
      - GF_AUTH_GENERIC_OAUTH_CLIENT_SECRET
      - GF_AUTH_GENERIC_OAUTH_ALLOW_SIGN_UP
      - GF_AUTH_GENERIC_OAUTH_TOKEN_URL
      - GF_AUTH_GENERIC_OAUTH_API_URL
      - GF_AUTH_GENERIC_OAUTH_AUTH_URL
      - GF_AUTH_OAUTH_AUTO_LOGIN
      - GF_AUTH_SIGNOUT_REDIRECT_URL
      - GF_AUTH_GENERIC_OAUTH_SCOPES
      - GF_DATABASE_TYPE
      - GF_DATABASE_HOST
      - GF_DATABASE_NAME
      - GF_DATABASE_SCHEMA
      - GF_DATABASE_USER
      - GF_DATABASE_PASSWORD
      - GF_DATABASE_SSL_MODE
      - GF_DATASOURCE_NAME
      - GF_DATASOURCE_TYPE
      - GF_DATASOURCE_ACCESS
      - GF_DATASOURCE_URL
      - GF_DATASOURCE_DATABASE
      - GF_DATASOURCE_USER
      - GF_DATASOURCE_PASSWORD
      - GF_DATASOURCE_SSL
      - GF_DATASOURCE_MAX_OPEN_CONNS
      - GF_DATASOURCE_VERSION
      - GF_DATASOURCE_TIMESCALEDB
  app:
    environment:
      - OIDC_SSO_APP_1_NAME
      - OIDC_SSO_APP_1_LOGIN_URL
      - OIDC_SSO_APP_1_LOGIN_METHOD
      - OIDC_SSO_APP_1_LOGOUT_URL
      - OIDC_SSO_APP_1_LOGOUT_METHOD
  proxy:
    depends_on:
      grafana:
        condition: service_started
